{"version":3,"sources":["bar-chart.tsx"],"names":["React","ReactNative","require","View","Image","Text","RNText","TouchableOpacity","TouchableWithoutFeedback","BarChart","SVGBarChart","Grid","YAxis","Rect","G","props","selectedBar","setSelectedBar","useState","key","value","useEffect","onSelect","barWidth","setBarWidth","positions","setPositions","barMargin","setBarMargin","colors","barChartData","data","map","chartData","index","svg","fill","color","onClick","onPress","total","reduce","a","b","Labels","args","x","y","bandwidth","barData","capHeight","fontSize","xPositions","labels","push","toFixed","length","x1","x2","margin","height","flexDirection","top","bottom","flexGrow","flex","item","left","right","stroke","alignItems","justifyContent","width","position","borderRadius","overflow","alignSelf","maxWidth","maxHeight","opacity","uri","textAlign","fontWeight"],"mappings":"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","sourcesContent":["import React from 'react';\nconst ReactNative = require('react-native');\nconst { View, Image, Text: RNText, TouchableOpacity, TouchableWithoutFeedback } = ReactNative;\nimport { BarChart as SVGBarChart, Grid, YAxis } from 'react-native-svg-charts';\nimport { Rect, G, Text } from 'react-native-svg';\n\ninterface ChartData {\n    key: string,\n    value: number,\n    color?: string\n}\n\nexport interface BarChartProps {\n    data: Array<ChartData>,\n    onSelect?(data?: ChartData): any,\n}\n\nexport default function BarChart(props: BarChartProps) {\n\n    const [selectedBar, setSelectedBar] = React.useState<ChartData>({\n        key: null,\n        value: null\n    })\n\n    React.useEffect(() => {\n        props.onSelect && props.onSelect(selectedBar)\n    }, [selectedBar])\n\n    const [barWidth, setBarWidth] = React.useState(0)\n    const [positions, setPositions] = React.useState([])\n    const [barMargin, setBarMargin] = React.useState(0)\n\n    const colors = ['#9EA8B7', '#7D6A80', '#74988C', '#3E5567', '#63819B']\n    const barChartData = props.data.map((chartData, index) => {\n        return {\n            key: chartData.key,\n            value: chartData.value,\n            svg: {\n                fill: chartData.color || colors[index],\n                onClick: () => setSelectedBar(chartData), // Make sure the svg is clickable in web app.\n                onPress: () => setSelectedBar(chartData)\n            },\n        }\n    })\n\n    const total = props.data.map(chartData => chartData.value).reduce((a, b) => a + b, 0)\n\n    const Labels = (args) => {\n        const { x, y, bandwidth, data } = args\n        const colors = data.map((barData) => barData.svg.fill)\n        const capHeight = 10\n        const fontSize = 14\n    \n        let xPositions = []\n        const labels = data.map((barData, index) => {\n            const { value, key } = barData\n            xPositions.push(x(index))\n            return (\n                <G key={index}>\n                    <Text\n                        x={x(index) + (bandwidth / 2)}\n                        y={y(value)-fontSize}\n                        fontSize={fontSize}\n                        fontWeight={ selectedBar && selectedBar.key === key ? 'bold' : 'normal'}\n                        fill={  selectedBar && selectedBar.key === key ? 'black' : 'gray'}\n                        alignmentBaseline={'middle'}\n                        textAnchor={'middle'}\n                    >\n                        {(value / total * 100).toFixed(1) + '%'}\n                    </Text>\n                    <Rect\n                        x={x(index)}\n                        y={y(value) - capHeight / 2 } // Subtract Height / 2 to make half of the Rect above the bar\n                        rx={capHeight / 2} // Set to Height / 2\n                        ry={capHeight / 2} // Set to Height / 2\n                        width={bandwidth}\n                        height={10} // Height of the Rect\n                        fill={colors[index]}\n                    />\n                </G>\n            )\n        })\n\n        if (barWidth === 0) {\n            setBarWidth(bandwidth)\n            setPositions(xPositions)\n            if (xPositions.length > 2) {\n                let x1 = xPositions[1]\n                let x2 = xPositions[2]\n                const margin = (x2 - x1 - bandwidth) / 2\n                setBarMargin(margin)\n            }\n        }\n        \n        return labels\n    }\n\n    return (\n        <TouchableWithoutFeedback onPress={() =>  setSelectedBar(null) }>\n        <View style={{ height: 250, flexDirection: 'row' }}>\n            <YAxis\n                data={barChartData.map((chartData) => chartData.value)}\n                contentInset={{ top: 25, bottom: 70 }}\n                svg={{\n                    fill: 'grey',\n                    fontSize: 12,\n                }}\n                numberOfTicks={4}\n                min={0}\n                formatLabel={(value) => `${(value / total * 100).toFixed(0)}%`}\n            />\n            <View style={{ flexGrow: 1 }}>\n                <SVGBarChart\n                    style={{ flex: 1 }}\n                    data={barChartData}\n                    gridMin={0}\n                    yAccessor={({ item }) => item.value}\n                    contentInset={{ top: 25, bottom: 10, left: 40, right: 40 }}\n                    spacingInner={0.5}\n                >\n                    <Grid svg={{ stroke: '#e3e3e3' }} />\n                    <Labels />\n                </SVGBarChart>\n                {   barWidth > 0 &&\n                    <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'center', height: 60 }}>\n                        { barChartData.map((chartData, index) => {\n                            return (\n                                <View key={index} style={{ width: barWidth + 2 * barMargin, height: '100%', position: 'absolute', left: positions[index] - barMargin }}>\n                                    <TouchableOpacity\n                                        onPress={() => {\n                                            setSelectedBar(chartData)\n                                        }}\n                                        style={{ width: barWidth, height: barWidth, borderRadius: barWidth/2, overflow: 'hidden', alignSelf: 'center', maxWidth: 40, maxHeight: 40 }}\n                                    >\n                                        <Image\n                                            style={{width: '100%', height: '100%', opacity: selectedBar && selectedBar.key === chartData.key ? 1 : 0.5}}\n                                            resizeMode={\"cover\"}\n                                            source={{uri: 'https://reactnative.dev/img/tiny_logo.png'}}\n                                        />\n                                    </TouchableOpacity>\n                                    <View style={{ flexGrow: 1 }}>\n                                        <RNText\n                                            numberOfLines={2}\n                                            style={{ textAlign: 'center', fontWeight: selectedBar && selectedBar.key === chartData.key ? 'bold' : 'normal' }}\n                                        >\n                                            {barChartData.map((chartData) => chartData.key)[index]}\n                                        </RNText>\n                                    </View>\n                                </View>\n                            )\n                        }) }\n                        \n                    </View>\n                }\n            </View>\n        </View>\n        </TouchableWithoutFeedback>\n    )\n}"]}